using System;
using Brother.Tests.Selenium.Lib.Support.HelperClasses;
using Brother.WebSites.Core.Pages.Base;
using Brother.WebSites.Core.Pages.BrotherOnline.AccountManagement;
using Brother.WebSites.Core.Pages.OmniJoin;
using Brother.WebSites.Core.Pages.OmniJoin.Trial;
using NUnit.Framework;
using TechTalk.SpecFlow;

namespace Brother.Tests.Specs.OmniJoin.FreeTrial
{
    [Binding]
    public class FreeTrialSteps : BaseSteps
    {
        [Then(@"If I click on Start Free Trial")]
        [Given(@"If I click on Start Free Trial")]
        public void GivenIfIClickOnStartFreeTrial()
        {
            NextPage = CurrentPage.As<WebConferencingHomePage>().GettingStartedButtonClick();
        }

        [Given(@"I click on Try Now")]
        public void GivenIClickOnTryNow()
        {
            NextPage = CurrentPage.As<WelcomeBackPage>().OmniJoinTryNowButtonClick();
        }

        [Then(@"I should be directed to the OmniJoin Free Trial page")]
        public void ThenIShouldBeDirectedToTheOmniJoinFreeTrialPage()
        {
            CurrentPage.As<FreeTrialPage>().IsSubmitButtonAvailable();
        }

        [When(@"I have entered a valid First and Last name, ""(.*)"", ""(.*)""")]
        public void WhenIHaveEnteredAValidFirstAndLastName(string firstName, string lastName)
        {
            CurrentPage.As<FreeTrialPage>().PopulateFirstNameTextBox(firstName);
            CurrentPage.As<FreeTrialPage>().PopulateLastNameTextBox(lastName);
        }
        [Then(@"I enter an invalid email address as ""(.*)"" for omnijoin free trial")]
        public void ThenIEnterAnInvalidEmailAddressAsForOmnijoinFreeTrial(string invalidemailaddress)
        {
            CurrentPage.As<FreeTrialPage>().PopulateInvalidEmailAddressTextBox(invalidemailaddress);
            
        }
        [Then(@"I should see the Error Message displayed on the Email Address field")]
        public void ThenIShouldSeeTheErrorMessageDisplayedOnTheEmailAddressField()
        {
            CurrentPage.As<FreeTrialPage>().ErrorMessageDisplayed();
        }

        [When(@"I have entered a Free Trial AutoGenerated email address")]
        public void WhenIHaveEnteredAFreeTrialAutoGeneratedEmailAddress()
        {
            CurrentPage.As<FreeTrialPage>().PopulateEmailAddressTextBox(string.Empty);
        }

        [When(@"I have entered a valid email address")]
        public void WhenIHaveEnteredAValidEmailAddress()
        {
            CurrentPage.As<FreeTrialPage>().PopulateEmailAddressTextBox(Email.RegistrationEmailAddress);
        }

        [When(@"I have entered a valid phone number ""(.*)""")]
        public void WhenIHaveEnteredAValidPhoneNumber(string phoneNumber)
        {
            CurrentPage.As<FreeTrialPage>().PopulatePhoneNumberTextBox(phoneNumber);
        }

        [When(@"I have Agreed to the Free Trial Terms and Conditions")]
        public void WhenIHaveAgreedToTheFreeTrialTermsAndConditions()
        {
            CurrentPage.As<FreeTrialPage>().AgreeToTermsAndConditions();
        }

        [When(@"if I click Submit")]
        public void WhenIfIClickSubmit()
        {
            NextPage = CurrentPage.As<FreeTrialPage>().SubmitButtonClick();
        }

        [Then(@"I should be directed to the download page indicating I have (.*) days Free trial")]
        public void ThenIShouldBeDirectedToTheDownloadPageIndicatingIHaveDaysFreeTrial(int freeTrialPeriod)
        {
            var expiryDate = CurrentPage.As<FreeTrialDownloadPage>().GetTrialExpiryDate();
            var currentDate = DateTime.Today.AddDays(freeTrialPeriod).ToString("dd MMMM yyyy");
            TestCheck.AssertIsEqual(currentDate, expiryDate, "OmniJoin Free Trial - Invalid expiry Date");
        }

        [When(@"I enter a Free Trial Password of ""(.*)""")]
        public void WhenIEnterAFreeTrialPasswordOf(string password)
        {
            CurrentPage.As<FreeTrialPage>().PopulatePasswordTextBox(password);
        }

        [When(@"I enter a Free Trial Password confirmation of ""(.*)""")]
        public void WhenIEnterAFreeTrialPasswordConfirmationOf(string confirmedPassword)
        {
            CurrentPage.As<FreeTrialPage>().PopulateConfirmPasswordTextBox(confirmedPassword);
        }


    #region "Production ("Live") test. DO NOT add Credit Card details steps to the method below
        [Then(@"Create an OmniJoin Free Trial")]
        public void ThenCreateAnOmniJoinFreeTrial()
        {
            ThenIShouldBeDirectedToTheOmniJoinFreeTrialPage();
            WhenIHaveEnteredAValidFirstAndLastName("AutoTest", "AutoTest");
            WhenIHaveEnteredAValidEmailAddress();
            WhenIHaveEnteredAValidPhoneNumber("01555 555555");
            WhenIHaveAgreedToTheFreeTrialTermsAndConditions();
            WhenIfIClickSubmit();
            ThenIShouldBeDirectedToTheDownloadPageIndicatingIHaveDaysFreeTrial(14);
        }
#endregion

    }
}
